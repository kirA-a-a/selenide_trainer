<!DOCTYPE html>
<html>
<head>
    <title>Keyboard Training</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Базовый стиль */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        /* Контейнер */
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Иконка контейнера */
        .container::before {
            content: "⌨️";
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8px 16px;
            border-radius: 50%;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        /* Заголовок */
        h1 {
            color: #333;
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 32px;
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h1::after {
            content: "";
            display: block;
            width: 100px;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 16px auto 0;
            border-radius: 2px;
        }

        /* Инструкция */
        .instruction {
            text-align: center;
            color: #666;
            font-size: 16px;
            margin-bottom: 32px;
            padding: 16px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
        }

        /* Поле ввода */
        .input-group {
            margin-bottom: 32px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .input-group input[type="text"] {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }

        .input-group input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        /* Элемент для отображения введенного текста */
        .input-value-display {
            margin-top: 12px;
            padding: 12px 16px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            font-size: 16px;
            color: #333;
            min-height: 24px;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
        }

        .input-value-display.empty {
            color: #999;
            font-style: italic;
        }

        .input-value-display.empty::before {
            content: "Введенный текст будет отображаться здесь...";
        }

        /* Область отображения клавиш */
        .keys-display {
            min-height: 400px;
            padding: 24px;
            background: rgba(102, 126, 234, 0.03);
            border-radius: 12px;
            border: 2px dashed rgba(102, 126, 234, 0.2);
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-content: flex-start;
            position: relative;
        }

        .keys-display.empty::before {
            content: "Нажмите любую клавишу на клавиатуре";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #999;
            font-size: 18px;
            pointer-events: none;
        }

        /* Стиль кнопки клавиши */
        .key-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            animation: keyPress 0.3s ease-out;
            min-width: 60px;
            min-height: 50px;
            position: relative;
            overflow: hidden;
        }

        .key-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .key-button:hover::before {
            left: 100%;
        }

        /* Анимация появления клавиши */
        @keyframes keyPress {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(-20px);
            }
            50% {
                transform: scale(1.1) translateY(-5px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Специальные стили для разных типов клавиш */
        .key-button.special {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            font-size: 16px;
        }

        .key-button.arrow {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .key-button.modifier {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .key-button.number {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        /* Кнопка очистки */
        .clear-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 24px;
            width: 100%;
        }

        .clear-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }

        .clear-btn:active {
            transform: translateY(0);
        }

        /* Счетчик */
        .counter {
            text-align: center;
            margin-top: 16px;
            font-size: 18px;
            color: #666;
            font-weight: 600;
        }

        /* Футер */
        .footer {
            width: 100%;
            text-align: center;
            padding: 12px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 14px;
            opacity: 0.9;
            position: fixed;
            bottom: 0;
            left: 0;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
<div class="container" data-test-id="keyboard-training-container">
    <h1 id="keyboard-title" data-test-id="keyboard-title" data-alias-selector="#keyboard-title-alias">
        Проверка нажатия клавиш на клавиатуре
    </h1>
    <span id="keyboard-title-alias" style="display: none;" data-test-id="keyboard-title-alias">Keyboard Training Title</span>
    
    <div class="instruction" data-test-id="instruction">
        Нажмите любую клавишу на клавиатуре, и она появится на экране
    </div>
    
    <div class="input-group">
        <label for="textInput" data-test-id="input-label">Поле ввода для символов:</label>
        <input type="text" id="textInput" name="textInput" 
               placeholder="Введите текст здесь..." 
               value=""
               data-test-id="text-input">
        <div class="input-value-display empty" id="inputValueDisplay" data-test-id="input-value-display"></div>
    </div>
    
    <div class="keys-display empty" id="keysDisplay" data-test-id="keys-display"></div>
    
    <div class="counter" data-test-id="key-counter">
        Нажато клавиш: <span id="keyCount">0</span>
    </div>
    
    <button class="clear-btn" id="clearBtn" data-test-id="clear-button">Очистить</button>
</div>

<div class="footer" data-test-id="trainer-footer">Safronov_ID • Тренажер для AQA</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const keysDisplay = document.getElementById('keysDisplay');
    const keyCount = document.getElementById('keyCount');
    const clearBtn = document.getElementById('clearBtn');
    const textInput = document.getElementById('textInput');
    const inputValueDisplay = document.getElementById('inputValueDisplay');
    let count = 0;
    let lastInputLength = 0;

    // Маппинг названий клавиш для отображения
    const keyNames = {
        ' ': 'Space',
        'Enter': 'Enter',
        'Escape': 'Escape',
        'Esc': 'Escape',
        'Tab': 'Tab',
        'Backspace': 'Backspace',
        'Delete': 'Delete',
        'Insert': 'Insert',
        'Home': 'Home',
        'End': 'End',
        'PageUp': 'Page Up',
        'PageDown': 'Page Down',
        'ArrowUp': '↑',
        'ArrowDown': '↓',
        'ArrowLeft': '←',
        'ArrowRight': '→',
        'Shift': 'Shift',
        'Control': 'Ctrl',
        'Alt': 'Alt',
        'Meta': 'Meta',
        'CapsLock': 'Caps Lock',
        'NumLock': 'Num Lock',
        'ScrollLock': 'Scroll Lock',
        'F1': 'F1',
        'F2': 'F2',
        'F3': 'F3',
        'F4': 'F4',
        'F5': 'F5',
        'F6': 'F6',
        'F7': 'F7',
        'F8': 'F8',
        'F9': 'F9',
        'F10': 'F10',
        'F11': 'F11',
        'F12': 'F12'
    };

    // Определение типа клавиши для стилизации
    function getKeyType(key) {
        if (key.startsWith('Arrow')) return 'arrow';
        if (['Shift', 'Control', 'Alt', 'Meta'].includes(key)) return 'modifier';
        if (['Enter', 'Escape', 'Esc', 'Tab', 'Backspace', 'Delete', 'Insert', 'Home', 'End', 'PageUp', 'PageDown', 'CapsLock', 'NumLock', 'ScrollLock'].includes(key)) return 'special';
        if (/^F\d+$/.test(key)) return 'special';
        if (/^\d$/.test(key)) return 'number';
        return 'normal';
    }

    // Создание элемента кнопки клавиши
    function createKeyButton(key) {
        const button = document.createElement('div');
        button.className = 'key-button';
        
        const displayName = keyNames[key] || key;
        button.textContent = displayName;
        button.setAttribute('data-key', key);
        button.setAttribute('data-test-id', `key-${key.toLowerCase().replace(/\s+/g, '-')}`);
        
        const keyType = getKeyType(key);
        if (keyType !== 'normal') {
            button.classList.add(keyType);
        }
        
        return button;
    }

    // Обработчик нажатия клавиши
    function handleKeyPress(event) {
        // Если событие происходит в поле ввода, не предотвращаем стандартное поведение
        if (event.target === textInput) {
            return;
        }
        
        event.preventDefault();
        
        const key = event.key;
        const code = event.code;
        
        // Используем key для отображения, если это обычная клавиша
        // Иначе используем code для специальных клавиш
        let displayKey = key;
        
        if (key.length > 1 || key === ' ') {
            // Для специальных клавиш используем code или key
            displayKey = code || key;
        }
        
        addKeyButton(displayKey);
    }

    // Функция добавления кнопки клавиши
    function addKeyButton(displayKey) {
        // Убираем класс empty при первом нажатии
        if (keysDisplay.classList.contains('empty')) {
            keysDisplay.classList.remove('empty');
        }
        
        // Создаем и добавляем кнопку
        const keyButton = createKeyButton(displayKey);
        keysDisplay.appendChild(keyButton);
        
        // Обновляем счетчик
        count++;
        keyCount.textContent = count;
        
        // Прокрутка вниз при необходимости
        keysDisplay.scrollTop = keysDisplay.scrollHeight;
    }

    // Функция для обновления атрибута value у поля ввода и отображения текста в элементе
    function updateInputValueAttribute() {
        const currentValue = textInput.value || '';
        // Устанавливаем атрибут value в HTML-разметке
        // Сначала удаляем старый атрибут, затем добавляем новый для гарантии обновления
        textInput.removeAttribute('value');
        textInput.setAttribute('value', currentValue);
        
        // Обновляем текстовое содержимое элемента верстки и добавляем в HTML-разметку
        if (currentValue) {
            inputValueDisplay.textContent = currentValue;
            // Добавляем текст в data-атрибут для видимости в HTML-разметке
            inputValueDisplay.setAttribute('data-value', currentValue);
            // Также добавляем как атрибут value для совместимости
            inputValueDisplay.setAttribute('value', currentValue);
            inputValueDisplay.classList.remove('empty');
        } else {
            inputValueDisplay.textContent = '';
            inputValueDisplay.removeAttribute('data-value');
            inputValueDisplay.removeAttribute('value');
            inputValueDisplay.classList.add('empty');
        }
    }

    // Обработчик ввода в текстовое поле
    function handleInput(event) {
        const currentValue = textInput.value;
        const currentLength = currentValue.length;
        
        // Обновляем атрибут value синхронно
        updateInputValueAttribute();
        // Дополнительное обновление через requestAnimationFrame для гарантии
        requestAnimationFrame(() => {
            updateInputValueAttribute();
        });
        
        if (currentLength > lastInputLength) {
            // Добавлен новый символ
            const newChar = currentValue[currentLength - 1];
            addKeyButton(newChar);
        } else if (currentLength < lastInputLength) {
            // Удален символ (Backspace или Delete)
            addKeyButton('Backspace');
        }
        
        lastInputLength = currentLength;
    }

    // Обработчик специальных клавиш в поле ввода
    function handleInputKeyDown(event) {
        const key = event.key;
        const code = event.code;
        
        // Обрабатываем специальные клавиши, которые не добавляют символы
        if (key === 'Enter' || key === 'Tab' || key === 'Escape' || key === 'Esc') {
            event.preventDefault();
            let displayKey = code || key;
            addKeyButton(displayKey);
        } else if (key === 'ArrowUp' || key === 'ArrowDown' || key === 'ArrowLeft' || key === 'ArrowRight') {
            let displayKey = code || key;
            addKeyButton(displayKey);
        }
        
        // Обновляем атрибут value после обработки клавиши
        // Используем несколько таймаутов для гарантии обновления
        setTimeout(() => {
            updateInputValueAttribute();
        }, 0);
        setTimeout(() => {
            updateInputValueAttribute();
        }, 10);
    }

    // Обработчик очистки
    clearBtn.addEventListener('click', function() {
        keysDisplay.innerHTML = '';
        keysDisplay.classList.add('empty');
        count = 0;
        keyCount.textContent = count;
        textInput.value = '';
        lastInputLength = 0;
        updateInputValueAttribute();
    });

    // Добавляем обработчик события keydown для всей страницы
    document.addEventListener('keydown', handleKeyPress);
    
    // Обработчики для поля ввода
    textInput.addEventListener('input', handleInput);
    textInput.addEventListener('keydown', handleInputKeyDown);
    textInput.addEventListener('keyup', function() {
        updateInputValueAttribute();
    });
    textInput.addEventListener('change', updateInputValueAttribute);
    textInput.addEventListener('blur', updateInputValueAttribute);
    textInput.addEventListener('paste', function() {
        setTimeout(() => {
            updateInputValueAttribute();
        }, 0);
    });
    
    // Инициализация длины поля ввода и атрибута value
    lastInputLength = textInput.value.length;
    updateInputValueAttribute();
    
    // Фокус на странице для гарантии работы обработчика
    window.focus();
    
    console.log('Keyboard training initialized');
});
</script>
</body>
</html>

